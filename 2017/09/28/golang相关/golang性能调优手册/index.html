<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Title -->
    
    <title>
        
            golang性能调优手册 | 
        
        cxf&#39;s blog
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="treachery">
    <meta name="description" itemprop="description" content="那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。">
    <meta name="keywords" content="treachery, blog, hexo, Web, 博客,golang相关">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.jpeg">
    <link rel="icon" sizes="192x192" href="/img/favicon.jpeg">
    <link rel="apple-touch-icon" href="/img/favicon.jpeg">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="cxf&#39;s blog">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    
        
            <link rel=alternate type="application/atom+xml" href="atom.xml">
        
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(http://img.netbian.com/file/2017/1225/cec912f837e957d14c4083819f1fc628.jpg);
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Light.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Light.woff') format('woff');
        }
        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto LightItalic'), local('Roboto-LightItalic'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-LightItalic.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-LightItalic.woff') format('woff');
          }
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto Regular'), local('Roboto-Regular'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Regular.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Regular.woff') format('woff');
        }
        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto RegularItalic'), local('Roboto-RegularItalic'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-RegularItalic.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-RegularItalic.woff') format('woff');
          }
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 500;
            src: local('Roboto Medium'), local('Roboto-Medium'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Medium.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Medium.woff') format('woff');
        }
        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 500;
            src: local('Roboto MediumItalic'), local('Roboto-MediumItalic'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-MediumItalic.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-MediumItalic.woff') format('woff');
        }
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: local('Material Icons'),
            local('MaterialIcons-Regular'),
            url(https://cdnjs.cat.net/ajax/libs/material-design-icons/3.0.1/iconfont/MaterialIcons-Regular.woff2) format('woff2'),
            url(https://cdnjs.cat.net/ajax/libs/material-design-icons/3.0.1/iconfont/MaterialIcons-Regular.woff) format('woff'),
            url(https://cdnjs.cat.net/ajax/libs/material-design-icons/3.0.1/iconfont/MaterialIcons-Regular.ttf) format('truetype');
        }
    </style>


<!-- Import Material Icon -->





    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://treachery.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="golang性能调优手册 | cxf&#39;s blog">
    <meta property="og:image" content="http://treachery.github.io/img/favicon.jpeg" />
    <meta property="og:description" content="那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。">
    <meta property="og:article:tag" content="golang相关"> 

    
        <meta property="article:published_time" content="Thu Sep 28 2017 09:10:25 GMT+0800" />
        <meta property="article:modified_time" content="Fri Dec 29 2017 01:09:09 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="golang性能调优手册 | cxf&#39;s blog">
    <meta name="twitter:description" content="那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。">
    <meta name="twitter:image" content="http://treachery.github.io/img/favicon.jpeg">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://treachery.github.io" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/index.html",
    "headline": "golang性能调优手册",
    "datePublished": "Thu Sep 28 2017 09:10:25 GMT+0800",
    "dateModified": "Fri Dec 29 2017 01:09:09 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "treachery",
        "image": {
            "@type": "ImageObject",
            "url": "http://ww2.sinaimg.cn/large/7f318987jw1f72m7gv450j205k05kmx1.jpg"
        },
        "description": "那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。"
    },
    "publisher": {
        "@type": "Organization",
        "name": "cxf&#39;s blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.jpeg"
        }
    },
    "keywords": ",golang相关treachery, blog, hexo, Web, 博客",
    "description": "那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#golang性能调优"><span class="post-toc-number">1.</span> <span class="post-toc-text"><a href="#golang&#x6027;&#x80FD;&#x8C03;&#x4F18;" class="headerlink" title="golang&#x6027;&#x80FD;&#x8C03;&#x4F18;"></a>golang&#x6027;&#x80FD;&#x8C03;&#x4F18;</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言："><span class="post-toc-number">1.1.</span> <span class="post-toc-text"><a href="#&#x524D;&#x8A00;&#xFF1A;" class="headerlink" title="&#x524D;&#x8A00;&#xFF1A;"></a>&#x524D;&#x8A00;&#xFF1A;</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CPU分析"><span class="post-toc-number">1.2.</span> <span class="post-toc-text"><a href="#CPU&#x5206;&#x6790;" class="headerlink" title="CPU&#x5206;&#x6790;"></a>CPU&#x5206;&#x6790;</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#抓取数据"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text"><a href="#&#x6293;&#x53D6;&#x6570;&#x636E;" class="headerlink" title="&#x6293;&#x53D6;&#x6570;&#x636E;"></a>&#x6293;&#x53D6;&#x6570;&#x636E;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分析数据"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text"><a href="#&#x5206;&#x6790;&#x6570;&#x636E;" class="headerlink" title="&#x5206;&#x6790;&#x6570;&#x636E;"></a>&#x5206;&#x6790;&#x6570;&#x636E;</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#内存分析"><span class="post-toc-number">1.3.</span> <span class="post-toc-text"><a href="#&#x5185;&#x5B58;&#x5206;&#x6790;" class="headerlink" title="&#x5185;&#x5B58;&#x5206;&#x6790;"></a>&#x5185;&#x5B58;&#x5206;&#x6790;</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取数据"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text"><a href="#&#x83B7;&#x53D6;&#x6570;&#x636E;" class="headerlink" title="&#x83B7;&#x53D6;&#x6570;&#x636E;"></a>&#x83B7;&#x53D6;&#x6570;&#x636E;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据分析"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text"><a href="#&#x6570;&#x636E;&#x5206;&#x6790;" class="headerlink" title="&#x6570;&#x636E;&#x5206;&#x6790;"></a>&#x6570;&#x636E;&#x5206;&#x6790;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#优化建议"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text"><a href="#&#x4F18;&#x5316;&#x5EFA;&#x8BAE;" class="headerlink" title="&#x4F18;&#x5316;&#x5EFA;&#x8BAE;"></a>&#x4F18;&#x5316;&#x5EFA;&#x8BAE;</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#阻塞分析"><span class="post-toc-number">1.4.</span> <span class="post-toc-text"><a href="#&#x963B;&#x585E;&#x5206;&#x6790;" class="headerlink" title="&#x963B;&#x585E;&#x5206;&#x6790;"></a>&#x963B;&#x585E;&#x5206;&#x6790;</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据收集"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text"><a href="#&#x6570;&#x636E;&#x6536;&#x96C6;" class="headerlink" title="&#x6570;&#x636E;&#x6536;&#x96C6;"></a>&#x6570;&#x636E;&#x6536;&#x96C6;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据分析-1"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text"><a href="#&#x6570;&#x636E;&#x5206;&#x6790;-1" class="headerlink" title="&#x6570;&#x636E;&#x5206;&#x6790;"></a>&#x6570;&#x636E;&#x5206;&#x6790;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#优化建议-1"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text"><a href="#&#x4F18;&#x5316;&#x5EFA;&#x8BAE;-1" class="headerlink" title="&#x4F18;&#x5316;&#x5EFA;&#x8BAE;"></a>&#x4F18;&#x5316;&#x5EFA;&#x8BAE;</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#goroutine-profile"><span class="post-toc-number">1.5.</span> <span class="post-toc-text"><a href="#goroutine-profile" class="headerlink" title="goroutine profile"></a>goroutine profile</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GC-Trace"><span class="post-toc-number">1.6.</span> <span class="post-toc-text"><a href="#GC-Trace" class="headerlink" title="GC Trace"></a>GC Trace</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gctrace"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text"><a href="#gctrace" class="headerlink" title="gctrace"></a>gctrace</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#allocfreetrace"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text"><a href="#allocfreetrace" class="headerlink" title="allocfreetrace"></a>allocfreetrace</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gotraceback"><span class="post-toc-number">1.6.3.</span> <span class="post-toc-text"><a href="#gotraceback" class="headerlink" title="gotraceback"></a>gotraceback</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#GC控制"><span class="post-toc-number">1.6.4.</span> <span class="post-toc-text"><a href="#GC&#x63A7;&#x5236;" class="headerlink" title="GC&#x63A7;&#x5236;"></a>GC&#x63A7;&#x5236;</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#辅助工具"><span class="post-toc-number">1.7.</span> <span class="post-toc-text"><a href="#&#x8F85;&#x52A9;&#x5DE5;&#x5177;" class="headerlink" title="&#x8F85;&#x52A9;&#x5DE5;&#x5177;"></a>&#x8F85;&#x52A9;&#x5DE5;&#x5177;</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#golint"><span class="post-toc-number">1.7.1.</span> <span class="post-toc-text"><a href="#golint" class="headerlink" title="golint"></a>golint</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#go-vet"><span class="post-toc-number">1.7.2.</span> <span class="post-toc-text"><a href="#go-vet" class="headerlink" title="go vet"></a>go vet</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#race"><span class="post-toc-number">1.7.3.</span> <span class="post-toc-text"><a href="#race" class="headerlink" title="-race"></a>-race</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#管控中心修改记录"><span class="post-toc-number">1.8.</span> <span class="post-toc-text"><a href="#&#x7BA1;&#x63A7;&#x4E2D;&#x5FC3;&#x4FEE;&#x6539;&#x8BB0;&#x5F55;" class="headerlink" title="&#x7BA1;&#x63A7;&#x4E2D;&#x5FC3;&#x4FEE;&#x6539;&#x8BB0;&#x5F55;"></a>&#x7BA1;&#x63A7;&#x4E2D;&#x5FC3;&#x4FEE;&#x6539;&#x8BB0;&#x5F55;</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#worker-remotedebugger的内存泄露"><span class="post-toc-number">1.8.1.</span> <span class="post-toc-text"><a href="#worker-remotedebugger&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x9732;" class="headerlink" title="worker_remotedebugger&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x9732;"></a>worker_remotedebugger&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x9732;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#内存的强制回收"><span class="post-toc-number">1.8.2.</span> <span class="post-toc-text"><a href="#&#x5185;&#x5B58;&#x7684;&#x5F3A;&#x5236;&#x56DE;&#x6536;" class="headerlink" title="&#x5185;&#x5B58;&#x7684;&#x5F3A;&#x5236;&#x56DE;&#x6536;"></a>&#x5185;&#x5B58;&#x7684;&#x5F3A;&#x5236;&#x56DE;&#x6536;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#连接数控制，负载太高时，拒绝新连接"><span class="post-toc-number">1.8.3.</span> <span class="post-toc-text"><a href="#&#x8FDE;&#x63A5;&#x6570;&#x63A7;&#x5236;&#xFF0C;&#x8D1F;&#x8F7D;&#x592A;&#x9AD8;&#x65F6;&#xFF0C;&#x62D2;&#x7EDD;&#x65B0;&#x8FDE;&#x63A5;" class="headerlink" title="&#x8FDE;&#x63A5;&#x6570;&#x63A7;&#x5236;&#xFF0C;&#x8D1F;&#x8F7D;&#x592A;&#x9AD8;&#x65F6;&#xFF0C;&#x62D2;&#x7EDD;&#x65B0;&#x8FDE;&#x63A5;"></a>&#x8FDE;&#x63A5;&#x6570;&#x63A7;&#x5236;&#xFF0C;&#x8D1F;&#x8F7D;&#x592A;&#x9AD8;&#x65F6;&#xFF0C;&#x62D2;&#x7EDD;&#x65B0;&#x8FDE;&#x63A5;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#日志入数据库慢的问题"><span class="post-toc-number">1.8.4.</span> <span class="post-toc-text"><a href="#&#x65E5;&#x5FD7;&#x5165;&#x6570;&#x636E;&#x5E93;&#x6162;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="&#x65E5;&#x5FD7;&#x5165;&#x6570;&#x636E;&#x5E93;&#x6162;&#x7684;&#x95EE;&#x9898;"></a>&#x65E5;&#x5FD7;&#x5165;&#x6570;&#x636E;&#x5E93;&#x6162;&#x7684;&#x95EE;&#x9898;</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#调试发现将日志解析为sql语句偏慢，大约1500条-s作用。使用profile发现适用于字符串处理过程中使用大量的string-replace。采用字符串拼接代替替换。"><span class="post-toc-number">1.8.5.</span> <span class="post-toc-text"><a href="#&#x8C03;&#x8BD5;&#x53D1;&#x73B0;&#x5C06;&#x65E5;&#x5FD7;&#x89E3;&#x6790;&#x4E3A;sql&#x8BED;&#x53E5;&#x504F;&#x6162;&#xFF0C;&#x5927;&#x7EA6;1500&#x6761;-s&#x4F5C;&#x7528;&#x3002;&#x4F7F;&#x7528;profile&#x53D1;&#x73B0;&#x9002;&#x7528;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x5927;&#x91CF;&#x7684;string-replace&#x3002;&#x91C7;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x4EE3;&#x66FF;&#x66FF;&#x6362;&#x3002;" class="headerlink" title="&#x8C03;&#x8BD5;&#x53D1;&#x73B0;&#x5C06;&#x65E5;&#x5FD7;&#x89E3;&#x6790;&#x4E3A;sql&#x8BED;&#x53E5;&#x504F;&#x6162;&#xFF0C;&#x5927;&#x7EA6;1500&#x6761;/s&#x4F5C;&#x7528;&#x3002;&#x4F7F;&#x7528;profile&#x53D1;&#x73B0;&#x9002;&#x7528;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x5927;&#x91CF;&#x7684;string.replace&#x3002;&#x91C7;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x4EE3;&#x66FF;&#x66FF;&#x6362;&#x3002;"></a>&#x8C03;&#x8BD5;&#x53D1;&#x73B0;&#x5C06;&#x65E5;&#x5FD7;&#x89E3;&#x6790;&#x4E3A;sql&#x8BED;&#x53E5;&#x504F;&#x6162;&#xFF0C;&#x5927;&#x7EA6;1500&#x6761;/s&#x4F5C;&#x7528;&#x3002;&#x4F7F;&#x7528;profile&#x53D1;&#x73B0;&#x9002;&#x7528;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x5927;&#x91CF;&#x7684;string.replace&#x3002;&#x91C7;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x4EE3;&#x66FF;&#x66FF;&#x6362;&#x3002;</span></a></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                golang性能调优手册
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="http://ww2.sinaimg.cn/large/7f318987jw1f72m7gv450j205k05kmx1.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>treachery</strong>
        <span>9月 28, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="https://pan.baidu.com/share/qrcode?w=246&h=246&url=http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/golang相关/">golang相关</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=golang性能调优手册&url=http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/index.html&pic=http://treachery.github.io/img/favicon.jpeg&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=golang性能调优手册&url=http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/index.html&via=treachery" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="golang性能调优"><a href="#golang性能调优" class="headerlink" title="golang性能调优"></a>golang性能调优</h1><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>golang标准库附带了包runtime/pprof和/net/http/pprof用于程序的运行时监测。<br>帮助定位程序的cpu耗时，内存消耗回收，goroutine堆栈信息。另有tracers工具，可用于查看GC运行情况。</p>
<h2 id="CPU分析"><a href="#CPU分析" class="headerlink" title="CPU分析"></a>CPU分析</h2><h3 id="抓取数据"><a href="#抓取数据" class="headerlink" title="抓取数据"></a>抓取数据</h3><p>使用pprof工具有三种方法：</p>
<ol>
<li>导入test包的测试程序<br>直接使用go test -cpuprofile=cprof<br>将会生成文件cprof，使用go tool pprof cprof进行程序分析</li>
<li><p>导入runtime/pprof包<br>使用如下方法调用pprof的方法记录程序信息到文件中：</p>
<pre><code class="go">pprof.StartCPUProfile(f)
defer pprof.StopCPUProfile()
</code></pre>
</li>
<li><p>使用net/http/pprof包<br>对于持续运行的服务程序，这是最方便的方法。只需要导入net/http/pprof包并开启http监听，就能实时进行监控。例如添加<br>go func(){<br>http.ListenAndServe(“localhost:6060”,nil)<br>}()<br>访问<a href="http://localhost:6060:/debug/pprof可查看信息" target="_blank" rel="noopener">http://localhost:6060:/debug/pprof可查看信息</a></p>
</li>
</ol>
<h3 id="分析数据"><a href="#分析数据" class="headerlink" title="分析数据"></a>分析数据</h3><p>go tool pprof Manager.exe <a href="http://localhost:6060/debug/pprof/profile" target="_blank" rel="noopener">http://localhost:6060/debug/pprof/profile</a><br>等待一会儿，会生成一个程序运行的采样数据。pprof在程序中1s采样100次，根据采样的落点函数和执行代码，可分析各个函数占用cpu时间片的比例。</p>
<ol>
<li>top</li>
</ol>
<p>使用top查看耗时最多的函数：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>flat</td>
<td>采样点落在该函数累计时间</td>
</tr>
<tr>
<td>flat%</td>
<td>采样点落在该函数累计比例</td>
</tr>
<tr>
<td>sum%</td>
<td>前面比例的累计</td>
</tr>
<tr>
<td>cum</td>
<td>该函数加上被其调用的函数的采样点累计时间</td>
</tr>
<tr>
<td>cum%</td>
<td>该函数加上被其调用的函数的采样点累积百分比</td>
</tr>
</tbody>
</table>
<ul>
<li>list</li>
</ul>
<p>使用list 函数名 可以查看具体源码的采样时间</p>
<ul>
<li>web</li>
</ul>
<p>安装Cygwin，perl和Graphviz后，使用web命令可以直接生成一个各个函数模块的时间分配和调用图。每个box是一个function，根据function运行的采样数改变box的尺寸。从X到Y的一条边代表着X调用Y</p>
<ul>
<li>提示和建议</li>
</ul>
<p>提示：有三种特殊情形，pprof无法解开堆栈。GC，system和ExternalCode.</p>
<p>GC表示垃圾回收期间的用时</p>
<p>System表示goroutine调度程序，栈管理代码和其他辅助运行时代码的用时。</p>
<p>ExternalCode表示本地动态库的耗时</p>
<p>建议：<br>1.大量时间消耗在内存分配的函数，暗示该程序产生了大量的小内存分配工作。参考下面内存分析器部分的建议。</p>
<p>2.如果大量时间消耗在同步，互斥等待等，说明程序共享资源的访问有问题</p>
<p>3.如果大量时间消耗在系统调用读写，暗示程序产生大量的小块读写。可以考虑使用bufio来优化。</p>
<p>4.如果大量时间消耗在GC，说明程序分配了大量的临时对象，或者系统设置的堆栈空间太小，以至于GC频率过高。</p>
<h2 id="内存分析"><a href="#内存分析" class="headerlink" title="内存分析"></a>内存分析</h2><h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><p>类似cpu数据的获取<br>go test –memprofile<br>runtime/pprof.WriteHeapProfile<br><a href="http://localhost:6060:/debug/pprof/heap" target="_blank" rel="noopener">http://localhost:6060:/debug/pprof/heap</a></p>
<h3 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h3><p>提示：内存分析器采取抽样，所以抓取出来的结果不一定精确表示分配的值，仅仅是一个按比例的描述。这个抽样可以通过设置配置Runtime.MemProfileRate调整。如果比例为1，则所以申请信息会被记录，但这样影响执行效率。默认采样比例为每分配512kb内存就采样一次。</p>
<pre><code class="shell">go tool pprof 参数  manager.exe http://localhost:6060:/debug/pprof/heap
</code></pre>
<p>常用的参数有：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>–inuse_space</td>
<td>当前时间内申请的空间</td>
</tr>
<tr>
<td>–alloc_space</td>
<td>自程序启动以来全部的请求空间</td>
</tr>
<tr>
<td>–inuse_objects</td>
<td>当前时间内申请的对象</td>
</tr>
<tr>
<td>–alloc_objects</td>
<td>自程序启动以来全部的对象申请</td>
</tr>
<tr>
<td>–functions</td>
<td>报告在函数等级</td>
</tr>
<tr>
<td>–lines</td>
<td>报告到代码行等级</td>
</tr>
<tr>
<td>–addresses/–files</td>
<td>精确到指令地址等级 或文件等级</td>
</tr>
</tbody>
</table>
<p>如果需要减少内存消耗量，需要关注–inuse_space的信息。如果需要提升程序运行效率，则要关注–alloc_objects</p>
<p>总体监控，查看与内存和对象分配相关所有堆栈信息<br>查看：<a href="http://localhost://6060/debug/pprof/heap?debug=1" target="_blank" rel="noopener">http://localhost://6060/debug/pprof/heap?debug=1</a></p>
<p>前面4个数字分别代表（1:28416 [1:28416]）<br>num1: 存活的该对象个数<br>num2: 存活对象占用的内存<br>num3: 所有该类型对象个数<br>num4: 所有该类型对象申请的内存</p>
<h3 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h3><p>堆区使用的优化根据不同应用场景有所区别，但有几个基本原则是通用的：</p>
<ul>
<li><p>尽量将小对象合并为大对象，减少对象数量使用。例如：将*bytes.Buffer替换为bytes。使用bytes.Buffer时，提前使用bytes.Grow将缓冲大小设置到合适值。既能减少内存分配，也减轻GC负担。</p>
</li>
<li><p>同样生命周期的临时变量，使用结构体将他们合并，也能减少对象个数.下方代码使用结构体，将两次内存分配缩减为1次。不过，这样的优化会影响代码可读性，所以见仁见智吧</p>
</li>
</ul>
<pre><code class="go">for k,v:=range m{
    k1,v1:=k,v
    go func(ktemp string,string){
        //使用两个对象
    }(k1,v1)
}

for k,v:=range m{
    k1,v1:=struct{k1,v1 string}{k,v}
    go func(ktemp interface{},vtemp interface{}){
        //使用一个对象
    }(k1,v1)
}
</code></pre>
<ul>
<li><p>对于大部分你已经预估到大小的切片,使用预分配的方式可以减少内存分配次数，例如：</p>
</li>
<li><p>尽量使用占内存小的数据类型。例如使用int8</p>
</li>
<li><p>不包含指针的对象(注意：strings,slices,maps,chans包含隐性指针)，GC回收时不需要进行扫描。所以，优化的方向是，尽量减少那些频繁使用的对象里面的指针。1是可以用索引替换指针。二是可以将对象拆分为两个，一个包含指针但是使用不频繁，另一个不包含指针使用频繁。</p>
</li>
<li><p>使用freelist减少临时对象的申请和分配。标准库sync.Pool可用于管理临时对象。不过不恰当地使用该功能，可能会产生资源提前释放的错误。<br>更多内存问题的查找，使用GC Trace</p>
</li>
</ul>
<h2 id="阻塞分析"><a href="#阻塞分析" class="headerlink" title="阻塞分析"></a>阻塞分析</h2><h3 id="数据收集"><a href="#数据收集" class="headerlink" title="数据收集"></a>数据收集</h3><pre><code class="shell">runtime/pprof.Lookup(&quot;block&quot;).WriteTo
</code></pre>
<p>go test –blockprofile<br><a href="http://localhost:6060/debug/pprof/block" target="_blank" rel="noopener">http://localhost:6060/debug/pprof/block</a></p>
<p>阻塞调试默认情况没有开启，使用runtime.SetBlockProfileRate(rate)开启阻塞调试。该函数参数rate指定采样的微秒数内，一个阻塞事件发生的平均数。设置rate=1,获取所有的阻塞。</p>
<h3 id="数据分析-1"><a href="#数据分析-1" class="headerlink" title="数据分析"></a>数据分析</h3><p>每个阻塞的描述信息：阻塞总时间(ns)，阻塞次数，调用栈<br>并非所有阻塞都是坏的，当一个routine阻塞时，调用线程会切换到另一个routine执行，所以阻塞是go语言这种cooperative语言实现并行的特殊方式。并不同于C++或者java里面发生的mutex阻塞（C++和JAVA的线程调度机制，阻塞直接导致线程空载和上下文切换)</p>
<p>阻塞的几种情况：</p>
<ul>
<li>goroutine由time.Ticker阻塞是正常的。</li>
<li>goroutine由sync.WaitGroup阻塞一般也是正常的。</li>
<li>goroutine由sync.Cond阻塞就可能有问题，要视具体情况而定，<br>消费者阻塞一般是生产者过慢或资源竞争。生产者阻塞一般是消费者过慢，不过大部分情况问题不大。</li>
<li>由chan信号引起阻塞，表面通道大小限制了goroutine数量</li>
<li>由锁引起的阻塞，一般就比较糟糕了，说明你的调度可能有问题。<br>（可以加参数–ignore，忽略不需要打印的阻塞种类。）</li>
</ul>
<p>阻塞两个副作用：</p>
<ul>
<li>多核CPU没有充分使用，程序线程集中跑在某个或某几个核上，一般由于任务划分不细，work太少。可以使用Scheduler Trace来追踪。</li>
<li>过多的goroutine阻塞或解除阻塞消耗CPU时间。使用CPU profiler来调试（观察 System component）</li>
</ul>
<h3 id="优化建议-1"><a href="#优化建议-1" class="headerlink" title="优化建议"></a>优化建议</h3><ul>
<li>在生产者消费者通道中，尽量使用足够大的带缓冲的chan。</li>
<li>对读取较多的共享资源，使用RWMutex读写锁，读锁不会阻塞其他读者线程。</li>
<li>使用写时拷贝(copy-on-write)处理一些修改不频繁的共享变量。类似如下的方法。去掉了mutex，使得写操作不会阻塞读线程。</li>
<li>拆分共享变量，只提取出需要加锁那部分进行锁定。可减少共享资源引起的阻塞。</li>
<li>本地缓存然后批处理更新有助于减少不可分割共享资源的访问冲突</li>
<li>使用sync.Pool代替基于chan-based或者mutex-protected的freelist。因为sync.Pool底层使用更高效的调度尽量避免了block。</li>
</ul>
<h2 id="goroutine-profile"><a href="#goroutine-profile" class="headerlink" title="goroutine profile"></a>goroutine profile</h2><p>goroutine Profiler给出当先存活的routine的调用栈，方便定位负载均衡和死锁。</p>
<p>最常用的是使用<a href="http://localhost:6060:/debug/pprof/goroutine?debug=2。这会给出类似程序崩溃时的详细栈信息。也可以在程序中使用runtime/pprof.Lookup(&quot;goroutine&quot;).WriteTo读取。" target="_blank" rel="noopener">http://localhost:6060:/debug/pprof/goroutine?debug=2。这会给出类似程序崩溃时的详细栈信息。也可以在程序中使用runtime/pprof.Lookup(&quot;goroutine&quot;).WriteTo读取。</a></p>
<p>注意：处于”syscalss”状态的routine消耗一个操作系统线程，其他的不会(除了直接调用runtime.LockOSThread，不过该调用对profile是不可见的)。其他的协程，即使是”IO Wait”都不消耗操作系统线程，他们使用非阻塞的网络轮询器实现。</p>
<h2 id="GC-Trace"><a href="#GC-Trace" class="headerlink" title="GC Trace"></a>GC Trace</h2><h3 id="gctrace"><a href="#gctrace" class="headerlink" title="gctrace"></a>gctrace</h3><p>在代码中关闭gc:<br>defer debug.SetGCPercent(debug.SetGCPercent(-1))<br>启用GC trace需要设置环境变量GODEBUG=gctrace=1<br>输出格式：</p>
<p>gc # @#s  #%: #+#+# ms clock, #+#/#/#+# ms cpu,#-&gt;#-&gt;#MB, # MB goal , # P</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>解析</th>
</tr>
</thead>
<tbody>
<tr>
<td>gc #</td>
<td>GC次数编号</td>
</tr>
<tr>
<td>@#s</td>
<td>从程序开始的时间</td>
</tr>
<tr>
<td>#%</td>
<td>GC的时间占程序运行总时间的百分比</td>
</tr>
<tr>
<td>#+…+#</td>
<td>Wall-clock 和CPU time</td>
</tr>
<tr>
<td>#-&gt;#-&gt;#MB</td>
<td>堆大小 开始时-&gt;结束时-&gt;使用中</td>
</tr>
<tr>
<td># MB goal</td>
<td>触发下次强制GC需要达到的内存</td>
</tr>
<tr>
<td># P</td>
<td>运行的cpu核数</td>
</tr>
</tbody>
</table>
<p>wall-clock/CPU  times<br>(go语言的gc在1.4到1.5，1.5到1.7有较大改动，所以这个地方时间解释仅供1.5以下版本参考)</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>STW(stop the world) sweep termination</td>
<td>停止用户routine，启动清理</td>
</tr>
<tr>
<td>Concurrent mark and scan</td>
<td>堆扫描和标记时间，显著影响gc时间</td>
</tr>
<tr>
<td>STW mark termination</td>
<td>堆清理时间，通常与用户程序并行发生，影响不大</td>
</tr>
</tbody>
</table>
<p>关于垃圾回收的原理https：//lengzzz.com/note/gc-in-goang</p>
<p>一般2分钟发生一次强制GC。环境变量GOGC还可以设置下次发生GC的阈值，默认值100，表示的是当GO程序被分配了一块与当前内存相当大小的额外内存时，进行GC。<br>此外，GC是并行的，可以通过设置GOMAXPROCS来控制GC线程数量，不过数量有上限，go1.5是8</p>
<h3 id="allocfreetrace"><a href="#allocfreetrace" class="headerlink" title="allocfreetrace"></a>allocfreetrace</h3><p>设置环境变量GODEBUG=allocfreetrace=1<br>打印出内存分配的地址，大小，类型。以及分配内存的routine和分配栈。</p>
<h3 id="gotraceback"><a href="#gotraceback" class="headerlink" title="gotraceback"></a>gotraceback</h3><p>traceback用于在程序异常崩溃时，进行堆栈回溯记录，方便定位bug。</p>
<p>使用defer  recover记录error的堆栈<br>使用traceback记录panic的堆栈。</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>GOTRACEBACK=none</td>
<td>只输出panic的信息</td>
</tr>
<tr>
<td>GOTRACEBACK=single</td>
<td>只输出被认为引发panic异常的那个goroutine的相关信息</td>
</tr>
<tr>
<td>GOTRACEBACK=all</td>
<td>输出所有用户级goroutines的相关信息，除去与go runtime相关的stack frames</td>
</tr>
<tr>
<td>GOTRACEBACK=system</td>
<td>输出所有goroutines的相关信息，包含系统级routine</td>
</tr>
<tr>
<td>GOTRACEBACK=crash</td>
<td>输出发生panic时所有堆栈信息，在linux系统上还能生成core文件</td>
</tr>
</tbody>
</table>
<h3 id="GC控制"><a href="#GC控制" class="headerlink" title="GC控制"></a>GC控制</h3><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>debug.SetGCPercent(percent  int)</td>
<td>用于控制强制GC的临界增量。默认percent=100，表示当go程序新申请一块与当前堆占用内存等量的内存时，会强制进行GC扫描。</td>
</tr>
<tr>
<td>runtime.GC()</td>
<td>强制执行GC，标记清扫不使用的内存</td>
</tr>
<tr>
<td>debug.FreeOSMemory()</td>
<td>强制执行scavenger，将被GC标记的不使用内存返还给操作系统。</td>
</tr>
</tbody>
</table>
<p>参考：</p>
<p><a href="https://github.com/golang/go/issues/4171" target="_blank" rel="noopener">https://github.com/golang/go/issues/4171</a><br><a href="https://github.com/golang/go/issues/16930" target="_blank" rel="noopener">https://github.com/golang/go/issues/16930</a></p>
<h2 id="辅助工具"><a href="#辅助工具" class="headerlink" title="辅助工具"></a>辅助工具</h2><h3 id="golint"><a href="#golint" class="headerlink" title="golint"></a>golint</h3><p>检查代码规范</p>
<h3 id="go-vet"><a href="#go-vet" class="headerlink" title="go vet"></a>go vet</h3><p>检查代码隐患</p>
<h3 id="race"><a href="#race" class="headerlink" title="-race"></a>-race</h3><p>检测竞争</p>
<h2 id="管控中心修改记录"><a href="#管控中心修改记录" class="headerlink" title="管控中心修改记录"></a>管控中心修改记录</h2><h3 id="worker-remotedebugger的内存泄露"><a href="#worker-remotedebugger的内存泄露" class="headerlink" title="worker_remotedebugger的内存泄露"></a>worker_remotedebugger的内存泄露</h3><p>该worker使用bytes.Buffer存储调试记录，当有调试连接上来时，运行日志要写入buffer，然后连接从该buffer中读取数据。然而由于buffer会随着调试日志增多而不断申请内存，而日志读取完后内存又不会释放。造成一定量内存浪费。</p>
<p>经检测，使用如下方式可以使多余的内存回收</p>
<pre><code class="go">this.outputBuffer = bytes.NewBuffer(make([]byte, 0, 1024))
//或者
this. outputBuffer=nil
/*前者重新初始化buffer，用于在缓冲区为空时，减少内存浪费
后者直接释放buffer，用于调试连接断开，不再需要往buffer写数据时使用
*/
</code></pre>
<h3 id="内存的强制回收"><a href="#内存的强制回收" class="headerlink" title="内存的强制回收"></a>内存的强制回收</h3><p>新建一个线程，在内存负载高时强制执行runtime.GC()和debug.FreeOSMemory()</p>
<h3 id="连接数控制，负载太高时，拒绝新连接"><a href="#连接数控制，负载太高时，拒绝新连接" class="headerlink" title="连接数控制，负载太高时，拒绝新连接"></a>连接数控制，负载太高时，拒绝新连接</h3><h3 id="日志入数据库慢的问题"><a href="#日志入数据库慢的问题" class="headerlink" title="日志入数据库慢的问题"></a>日志入数据库慢的问题</h3><ul>
<li><p>存储过程参数化执行，数据库驱动会去查询该过程的参数表，导致执行效率慢。</p>
<p>  解决办法，直接将参数拼接到sql字符串里面，使用无参数执行。</p>
</li>
<li><p>批量执行的两种参考方案 prepare 和事务</p>
</li>
</ul>
<h3 id="调试发现将日志解析为sql语句偏慢，大约1500条-s作用。使用profile发现适用于字符串处理过程中使用大量的string-replace。采用字符串拼接代替替换。"><a href="#调试发现将日志解析为sql语句偏慢，大约1500条-s作用。使用profile发现适用于字符串处理过程中使用大量的string-replace。采用字符串拼接代替替换。" class="headerlink" title="调试发现将日志解析为sql语句偏慢，大约1500条/s作用。使用profile发现适用于字符串处理过程中使用大量的string.replace。采用字符串拼接代替替换。"></a>调试发现将日志解析为sql语句偏慢，大约1500条/s作用。使用profile发现适用于字符串处理过程中使用大量的string.replace。采用字符串拼接代替替换。</h3>
        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 3px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p><strong>
                         
                            本文采用 <a rel='nofollow noopener' href='https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh' target='_blank'>CC BY-NC-SA 3.0 Unported</a> 协议进行许可，阅读 <a href='/creativecommons.html' target='_blank'>相关说明</a>
                        </strong>
                        <br>
                        <strong>本文链接：</strong><a href="http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/">http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/</a>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://treachery.github.io/2017/09/28/golang相关/golang性能调优手册/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>
<script type="text/ls-javascript" id="disqus-thread-script">
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//https-janebt-github-io.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/09/28/管控中心/共享内存的回复/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/07/21/管控中心/文件句柄数/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="http://ww2.sinaimg.cn/large/7f318987jw1f72m7gv450j205k05kmx1.jpg" alt="treachery's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        526377874@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:526377874@qq.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">apps</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/golang/">golang<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/golang相关/">golang相关<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/博客栈/">博客栈<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/简历/">简历<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/管控中心/">管控中心<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags.html" title="标签">
                
                    <i class="material-icons sidebar-material-icons">bookmark</i>
                
                标签
            </a>
        </li>
        
    
        <li>
            <a href="/timeline.html" title="时间线">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                时间线
            </a>
        </li>
        
            <li class="divider"></li>
        
    
        <li>
            <a href="/gallery.html" title="映像">
                
                    <i class="material-icons sidebar-material-icons">photo</i>
                
                映像
            </a>
        </li>
        
    
        <li>
            <a href="/links.html" title="友链">
                
                    <i class="material-icons sidebar-material-icons">people</i>
                
                友链
            </a>
        </li>
        
            <li class="divider"></li>
        
    
        <li>
            <a href="/about.html" title="简历">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                简历
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">14</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/treachery" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>cxf's blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- 使用 DISQUS js 代码 -->
<script id="dsq-count-scr" src="//https-janebt-github-io.disqus.com/count.js" async></script>





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
